(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const e of i.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&n(e)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();const E=25;class h{constructor(t,r){this.x=t,this.y=r}add(t){return new h(this.x+t.x,this.y+t.y)}subtract(t){return new h(this.x-t.x,this.y-t.y)}divide(t){return new h(this.x/t,this.y/t)}get distance(){return Math.sqrt(this.x*this.x+this.y*this.y)}limit(t){const r=this.distance;return r>t?this.divide(r).multiply(t):this}multiply(t){return new h(this.x*t,this.y*t)}normalize(){return this.divide(this.distance)}rotate(t){const r=Math.cos(t),n=Math.sin(t);return new h(this.x*r-this.y*n,this.x*n+this.y*r)}}h.zero=new h(0,0);class p{constructor(t,r,n,s){this.x=t,this.y=r,this.width=n,this.height=s}static fromLTRB(t,r,n,s){return new p(t,r,n-t,s-r)}static fromSize(t){return new p(0,0,t.width,t.height)}static fromPoints(t,r){return p.fromLTRB(Math.min(t.x,r.x),Math.min(t.y,r.y),Math.max(t.x,r.x),Math.max(t.y,r.y))}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get size(){return{width:this.width,height:this.height}}moveTo(t,r){return new p(t,r,this.width,this.height)}translate(t,r){return this.moveTo(this.x+t,this.y+r)}get center(){return new h(this.x+this.width/2,this.y+this.height/2)}}p.zero=new p(0,0,0,0);class J{constructor(t,r){this.source=t,this.destination=r}static fromJson(t,r){const n=t.find(e=>e.id===r.source),s=t.find(e=>e.id===r.destination),i=new J(n,s);return r.data&&(i.data=r.data),i}toJSON(){return{source:this.source.id,destination:this.destination.id,data:this.data}}}class ${constructor(t){this.rect=new p(0,0,E,E),this.id=t}static fromJson(t){var r,n,s,i;const e=new $(t.id);t.data&&(e.data=t.data);const w=new h((r=t.x)!==null&&r!==void 0?r:0,(n=t.y)!==null&&n!==void 0?n:0),a={width:(s=t.width)!==null&&s!==void 0?s:E,height:(i=t.height)!==null&&i!==void 0?i:E};return e.rect=new p(w.x,w.y,a.width,a.height),e}get x(){return this.position.x}get y(){return this.position.y}get position(){return new h(this.rect.x,this.rect.y)}set position(t){this.rect=new p(t.x,t.y,this.rect.width,this.rect.height)}get width(){return this.rect.width}get height(){return this.rect.height}toJSON(){return{id:this.id,x:this.x,y:this.y,width:this.width,height:this.height,data:this.data}}}class I{constructor(t,r){this.nodes=t,this.edges=r}static fromJson(t){const r=t.nodes.map($.fromJson),n=t.edges.map(s=>J.fromJson(r,s));return new I(r,n)}toJson(){return{nodes:this.nodes.map(t=>t.toJSON()),edges:this.edges.map(t=>t.toJSON())}}successorsOf(t){return this.getOutEdges(t).map(r=>r.destination)}getOutEdges(t){return this.edges.filter(r=>r.source===t)}predecessorsOf(t){return this.getInEdges(t).map(r=>r.source)}getInEdges(t){return this.edges.filter(r=>r.destination===t)}getEdgeBetween(t,r){return this.edges.find(n=>n.source===t&&n.destination===r)}hasNodes(){return this.nodes.length>0}getNode(t){return this.nodes.find(r=>r.id===t)}}function W(){return new Worker("/graphview-typescript/assets/worker.100c89c2.js")}const L=new W;var q;const D=(q=document.getElementById("output"))!=null?q:document.body,z=D.getBoundingClientRect();let y;const N="black";let x=null;L.onmessage=f=>{var t,r,n,s;if(console.log(f.data),f.data.graph){if(y=I.fromJson(f.data.graph),f.data.type==="init"){const i=document.createElementNS("http://www.w3.org/2000/svg","svg"),{width:e,height:w}=f.data;i.setAttribute("width",e.toString()),i.setAttribute("height",w.toString()),i.setAttribute("viewBox",`0 0 ${e} ${w}`),i.setAttribute("preserveAspectRatio","xMidYMid meet"),i.setAttribute("style","overflow: visible");const a=document.createElementNS("http://www.w3.org/2000/svg","defs");i.appendChild(a);const u=document.createElementNS("http://www.w3.org/2000/svg","marker");u.setAttribute("id","arrowstart"),u.setAttribute("viewBox","0 0 13 10"),u.setAttribute("refX","2"),u.setAttribute("refY","5"),u.setAttribute("markerWidth","3.5"),u.setAttribute("markerHeight","3.5"),u.setAttribute("orient","auto"),u.setAttribute("fill","grey");const O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("d","M 13 0  C 13 0, 10 5, 13 10   L 13 10  L 0 5"),u.appendChild(O),a.appendChild(u);const C=u.cloneNode(!0);C.setAttribute("id","arrowstartactive"),C.setAttribute("fill",N),a.appendChild(C);const g=document.createElementNS("http://www.w3.org/2000/svg","marker");g.setAttribute("id","arrowend"),g.setAttribute("viewBox","0 0 13 10"),g.setAttribute("refX","11"),g.setAttribute("refY","5"),g.setAttribute("markerWidth","3.5"),g.setAttribute("markerHeight","3.5"),g.setAttribute("orient","auto"),g.setAttribute("fill","grey");const B=document.createElementNS("http://www.w3.org/2000/svg","path");B.setAttribute("d","M 0 0  C 0 0, 3 5, 0 10   L 0 10  L 13 5"),g.appendChild(B),a.appendChild(g);const M=g.cloneNode(!0);M.setAttribute("id","arrowendactive"),M.setAttribute("fill",N),a.appendChild(M);let P=[];for(const o of y.edges){if(P.some(l=>{const v=l.source.id===o.source.id,S=l.destination.id===o.destination.id;if(v&&S)return!0;const k=l.source.id===o.destination.id,T=l.destination.id===o.source.id;return!!(k&&T)}))continue;const A=y.edges.find(l=>l.source===o.destination&&l.destination===o.source),d=document.createElementNS("http://www.w3.org/2000/svg","line");d.setAttribute("data-source",o.source.id),d.setAttribute("data-destination",o.destination.id);const{start:b,end:c}=Y(o);if(d.setAttribute("x1",b.x.toString()),d.setAttribute("y1",b.y.toString()),d.setAttribute("x2",c.x.toString()),d.setAttribute("y2",c.y.toString()),d.setAttribute("fill","lightgray"),d.setAttribute("stroke","lightgray"),d.setAttribute("stroke-width","2"),d.setAttribute("marker-end","url(#arrowend)"),A&&(d.setAttribute("marker-start","url(#arrowstart)"),d.setAttribute("data-reverse","true"),P.push(o)),i.appendChild(d),(t=o.data)!=null&&t.name){const l=document.createElementNS("http://www.w3.org/2000/svg","title");l.textContent=o.data.name,d.appendChild(l)}}for(const o of y.nodes){const m=document.createElementNS("http://www.w3.org/2000/svg","g");m.setAttribute("data-id",o.id),m.setAttribute("transform",`translate(${o.x}, ${o.y})`);const A=(r=o.data)==null?void 0:r.backgroundColor,d=(n=o.data)==null?void 0:n.color,b=document.createElementNS("http://www.w3.org/2000/svg","circle");if(b.setAttribute("r",o.width.toString()),b.setAttribute("fill",A!=null?A:"grey"),b.setAttribute("stroke","black"),m.appendChild(b),(s=o.data)!=null&&s.name){const c=document.createElementNS("http://www.w3.org/2000/svg","text");c.textContent=o.data.name,c.setAttribute("text-anchor","middle"),c.setAttribute("alignment-baseline","middle"),c.setAttribute("fill",d!=null?d:"black"),c.setAttribute("font-size","8px"),m.appendChild(c)}m.addEventListener("pointerdown",c=>{c.preventDefault(),m.setPointerCapture(c.pointerId);const l=S=>{const k=new h(S.movementX,S.movementY);L.postMessage({type:"move",id:o.id,x:k.x,y:k.y})},v=()=>{window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",v),m.releasePointerCapture(c.pointerId)};window.addEventListener("pointermove",l),window.addEventListener("pointerup",v),x=o}),i.appendChild(m)}i.addEventListener("dblclick",()=>{x=null}),D.appendChild(i)}y.nodes.forEach(i=>{const e=document.querySelector(`g[data-id="${i.id}"]`);e&&e.setAttribute("transform",`translate(${i.x}, ${i.y})`)}),y.edges.forEach(i=>{let e=null;if(y.edges.find(a=>a.source===i.destination&&a.destination===i.source)?e=document.querySelector(`line[data-source="${i.destination.id}"][data-destination="${i.source.id}"]`):e=document.querySelector(`line[data-source="${i.source.id}"][data-destination="${i.destination.id}"]`),e){const{start:a,end:u}=Y(i);e.setAttribute("x1",a.x.toString()),e.setAttribute("y1",a.y.toString()),e.setAttribute("x2",u.x.toString()),e.setAttribute("y2",u.y.toString())}x&&(x.id===i.source.id||x.id===i.destination.id?(e==null||e.setAttribute("stroke",N),e==null||e.setAttribute("fill",N),e!=null&&e.hasAttribute("marker-start")&&(e==null||e.setAttribute("marker-start","url(#arrowstartactive)")),e!=null&&e.hasAttribute("marker-end")&&(e==null||e.setAttribute("marker-end","url(#arrowendactive)"))):(e==null||e.setAttribute("stroke","lightgray"),e==null||e.setAttribute("fill","lightgray"),e!=null&&e.hasAttribute("marker-start")&&(e==null||e.setAttribute("marker-start","url(#arrowend)")),e!=null&&e.hasAttribute("marker-end")&&(e==null||e.setAttribute("marker-end","url(#arrowend)"))))})}};L.postMessage({type:"init",width:z.width,height:z.height});function Y(f){const t=f.source,r=f.destination;let n=t.x,s=t.y,i=r.x,e=r.y;const w=Math.atan2(e-s,i-n);return n+=Math.cos(w)*t.width,s+=Math.sin(w)*t.height,i-=Math.cos(w)*r.width,e-=Math.sin(w)*r.height,{start:new h(n,s),end:new h(i,e)}}
